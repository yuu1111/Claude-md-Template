# CLAUDE.md ベストプラクティス

## 良い CLAUDE.md ファイルとは？

### 1. 具体的で実行可能であること

❌ **悪い例**: 「テストのベストプラクティスに従う」
✅ **良い例**: 「すべてのテストは `npm test`、コンポーネントテストは `npm test -- --watch src/components` を実行」

❌ **悪い例**: 「プロジェクトはモダンな React パターンを使用」
✅ **良い例**: 「コンポーネントは状態管理にフックを使用、グローバル状態は `src/contexts/` の Context API を使用」

### 2. 明白でない情報に焦点を当てる

含めるべき情報：
- 複数のファイルの理解が必要な情報
- プロジェクト固有の規約
- アーキテクチャの決定の説明
- 複雑なワークフローのドキュメント

スキップすべき情報：
- ファイル構造から明らかな情報
- 標準的なベストプラクティス
- package.json や他の設定ファイルから推測できる情報

### 3. 決定に対するコンテキストを提供

❌ **悪い例**: 「状態管理に Redux を使用」
✅ **良い例**: 「Redux でグローバル状態を管理；各機能は `src/store/features/` に独自のスライスを持つ。API 呼び出しには RTK Query を使用」

### 4. 実際のコマンドを文書化

❌ **悪い例**: 「コミット前にテストを実行」
✅ **良い例**: 「`npm run precommit` を実行（lint、型チェック、テストを実行）」

## 必須セクション

### ビルドコマンド
- 特別なフラグを含む正確なコマンドを含める
- 環境固有のバリエーションを文書化
- 明白でない場合は各コマンドの動作を説明

### アーキテクチャ
- 高レベルの構造とパターン
- 主要なアーキテクチャの決定とその根拠
- データフローと状態管理アプローチ

### 開発ワークフロー
- 一般的なタスクのステップバイステップのプロセス
- ブランチ命名規則
- PR 要件

### プロジェクト固有のパターン
- プロジェクト独自のカスタム規約
- 既知の問題の回避策
- パフォーマンス最適化

## 避けるべきこと

### 1. 一般的なベストプラクティス
❌ 「クリーンで保守可能なコードを書く」
❌ 「常に適切にエラーを処理する」
❌ 「新機能にはテストを書く」

### 2. 他で利用可能な情報
❌ package.json からすべての依存関係をリストする
❌ README 全体をコピーする
❌ 標準的なフレームワーク機能を詳述する

### 3. 冗長な指示
❌ 「コミット前にコードがコンパイルすることを確認」
❌ 「既存のコードスタイルに従う」
❌ 「機密情報をコミットしない」

## テンプレート変数

テンプレートでは明確なプレースホルダー名を使用：
- `[PROJECT_NAME]` - プロジェクト名
- `[PACKAGE_NAME]` - パッケージ/モジュール名
- `[PORT]` - ポート番号
- `[API_URL]` - API エンドポイント

## 長さのガイドライン

- **最小**: 必須コマンドとアーキテクチャをカバー（200-300 行）
- **理想**: 冗長性なく包括的（300-500 行）
- **最大**: 絶対に必要でない限り 800 行を超えない

## CLAUDE.md のテスト

1. **完全性テスト**: Claude Code は以下を理解できるか：
   - プロジェクトを実行できるか？
   - テストを実行できるか？
   - アーキテクチャを理解できるか？
   - 一般的な変更を行えるか？

2. **具体性テスト**: 
   - すべてのコマンドは完全で実行可能か？
   - ファイルパスは正確か？
   - 規約は明確に述べられているか？

3. **関連性テスト**:
   - すべてのセクションは実際に有用か？
   - 自動的に発見できるセクションはないか？
   - 明白なことを述べていないか？

## 良いセクションの例

### 良いビルドコマンドセクション
```markdown
## ビルドコマンド
- 開発サーバー: `npm run dev` (http://localhost:3000、ホットリロード有効)
- 本番: `npm run build && npm run preview`
- 型チェック: `npx tsc --noEmit`
- テストウォッチ: `npm test -- --watch --coverage`
```

### 良いアーキテクチャセクション
```markdown
## アーキテクチャ
API 呼び出しは `src/lib/api.ts` のインターセプター付き axios を使用。
すべてのエンドポイントは `src/services/` に定義。認証トークンは
インターセプター経由で自動的に付加。失敗したリクエストは
エクスポネンシャルバックオフで 3 回リトライ。
```

### 良いワークフローセクション
```markdown
## 新機能の追加
1. 機能ブランチを作成: `git checkout -b feature/[name]`
2. `src/types/[feature].ts` に型を追加
3. `src/services/[feature]Service.ts` に API サービスを実装
4. `src/features/[feature]/` にコンポーネントを作成
5. コンポーネントと一緒にテストを追加
6. PR 前に `npm run validate` を実行
```

## アンチパターン

### 過剰なドキュメント化
すべてのファイルや関数を文書化しない。パターンと高レベルの構造に焦点を当てる。

### 不十分なドキュメント化
Claude があなたの特定のセットアップを知っていると仮定しない。コマンドとパスについて明確にする。

### 古い情報
プロジェクトの進化に合わせて定期的に CLAUDE.md をレビューと更新する。

## クイックチェックリスト

CLAUDE.md を完成させる前に、以下を確認：

- [ ] すべてのコマンドが完全で実行可能
- [ ] アーキテクチャセクションが「何」だけでなく「なぜ」を説明
- [ ] プロジェクト固有のパターンが文書化されている
- [ ] 一般的なベストプラクティスが含まれていない
- [ ] ファイルパスが正確
- [ ] 指示が実行可能
- [ ] 他のファイルからの冗長な情報がない
- [ ] 明確なセクション構成